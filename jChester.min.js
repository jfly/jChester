/*
 *  jChester - v0.7.2
 *  A time entry component for speedcubing solves.
 *  https://github.com/jfly/jChester
 *
 *  Made by Jeremy Fleischman
 *  Under GPL-3.0 License
 */
!function(a){if(a){var b=90,c=45,d="1:00:00.00".length;a.fn.jChester=function(e,f){if(!this.is("div"))throw"jChester can only be applied to divs";a.isPlainObject(e)&&(f=e,e=null);var g=["millis","moveCount","puzzlesSolvedCount","puzzlesAttemptedCount"],h=this,i=a.extend({},a.fn.jChester.defaults,f),j=this.data("jChesterData");j||(j={},this.data("jChesterData",j),j.$form=a('<form class="form-inline" role="form">'),h.append(j.$form),j.$form.append(a('<div class="form-group"><input type="text" name="millis-mask" class="form-control" readonly tabindex="-1"></input><input name="millis" type="text" class="form-control"></input></div>')),j.$form.find('input[name="millis-mask"]').css({position:"absolute",backgroundColor:"white",fontFamily:"monospace",textAlign:"right"}),j.$form.find('input[name="millis"]').css({position:"relative",backgroundColor:"transparent",fontFamily:"monospace",textAlign:"right"}),j.$form.find('input[name="millis"]').attr("maxlength",d),j.$form.append(a('<div class="form-group"><input name="moveCount" type="text" class="form-control"></input></div>')),j.$form.append(document.createTextNode(" ")),j.$form.append(a('<div class="form-group"><input name="puzzlesSolvedCount" min="0" type="number" class="form-control"></input></div>')),j.$form.append(a('<span name="puzzlesAttemptedCount">&nbsp;/&nbsp;</span>')),j.$form.append(a('<div class="form-group"><input name="puzzlesAttemptedCount" min="0" type="number" class="form-control"></input></div>')),j.$form.append(a('<span class="help-block">')),j.$form.find('input[type="text"]').width(b),j.$form.find('input[type="number"]').width(c),j.$form.find(".form-group").css({display:"inline-block"}),j.inputChanged=function(){var b={},c=null;if(j.editableSolveTimeFields.millis){var d=j.$form.find('input[name="millis"]'),e=j.$form.find('input[name="millis-mask"]'),f=d.val();if(f=f.replace(/ /g,""),f.match(/^\d+$/)){var h=7;f.length>h&&(f=f.substring(0,h));var i=f.length,k=f.substring(i-2,i),l=f.substring(i-4,i-2),m=f.substring(i-6,i-4),n=f.substring(0,i-6),o="",p="",q=function(a,b){for(var c=0;c<b-a.length;c++)o+=" ",p+="0";o+=a,p+=a};n.length>0&&(q(n,1),q(":",0)),m.length>0&&(q(m,p.length>0?2:1),q(":",0)),q(l,p.length>0?2:1),q(".",0),q(k,2),d.val(o.replace(/[.:]/g," ")),e.val(p),f=o.replace(/ /g,"0")}else f!==d.val()&&d.val(f),e.val("");try{c=jChester.stopwatchFormatToSolveTime(f)}catch(a){0===f.length?b.millis="Please enter a time.":b.millis=a}}if(j.editableSolveTimeFields.moveCount){var r=j.$form.find('input[name="moveCount"]').val();try{c?a.extend(c,jChester.stopwatchFormatToSolveTime(r,!0)):c=jChester.stopwatchFormatToSolveTime(r,!0)}catch(a){0===r.length?b.moveCount="Please enter a number of moves.":b.moveCount=a}}var s,t;if(j.hideField={},c)if(jChester.solveTimeIsDNF(c))s="0",t="1",j.hideField.puzzlesSolvedCount=!0,j.hideField.puzzlesAttemptedCount=!0;else if(jChester.solveTimeIsDNS(c))s="0",t="0",j.hideField.puzzlesSolvedCount=!0,j.hideField.puzzlesAttemptedCount=!0;else if(j.editableSolveTimeFields.puzzlesSolvedCount||j.editableSolveTimeFields.puzzlesAttemptedCount){var u=j.$form.find('input[name="puzzlesSolvedCount"]');s=u.val();var v=j.$form.find('input[name="puzzlesAttemptedCount"]');t=v.val()}else s="1",t="1";else s=null,t=null,j.hideField.puzzlesSolvedCount=!0,j.hideField.puzzlesAttemptedCount=!0;if(c){if(jChester._isInt(s)){var w=parseInt(s);c.puzzlesSolvedCount=w}else b.puzzlesSolvedCount="Invalid number of puzzles solved.";if(jChester._isInt(t)){var x=parseInt(t);c.puzzlesAttemptedCount=x,!b.puzzlesSolvedCount&&c.puzzlesSolvedCount>c.puzzlesAttemptedCount&&(b.puzzlesAttemptedCount="Cannot have more puzzles solved than attemped.")}else b.puzzlesAttemptedCount="Invalid number of puzzles attempted."}var y=function(a){return b[a]};j.validationErrors=g.filter(y).map(y),j.validationErrors.length>0&&(c=null),j.solveTime=c,j.$form.find(".help-block").text(j.validationErrors.join(" ")),j.$form.find(".input-group").removeClass("has-error"),g.forEach(function(a){var c=j.$form.find('input[name="'+a+'"]'),d=c.parent(".form-group"),e=!!b[a];d.toggleClass("has-error",e)}),g.forEach(function(a){var b=j.editableSolveTimeFields[a]&&!j.hideField[a];b=!!b,j.$form.find('input[name="'+a+'"]').parent().toggle(b),j.$form.find('span[name="'+a+'"]').toggle(b)})},j.$form.find("input").on("input",function(){j.inputChanged(),h.trigger("solveTimeInput",[j.validationErrors,j.solveTime])}),j.$form.find("input").on("keydown",function(b){var c=a(b.currentTarget);("millis"===c.attr("name")||"moveCount"===c.attr("name"))&&!b.altKey&&!b.ctrlKey&!b.metaKey&&(106===b.which||68===b.which?(c.val("DNF"),c.select(),j.inputChanged(),h.trigger("solveTimeInput",[[],j.solveTime]),b.preventDefault()):111!==b.which&&83!==b.which||(c.val("DNS"),c.select(),j.inputChanged(),h.trigger("solveTimeInput",[[],j.solveTime]),b.preventDefault()))}),this.attr("tabindex","-1"),this.focus(function(b){var c=a(this).find("input:visible:not([readonly])").first();c.focus(),c.select()}));var k=function(a){if(null===a)j.$form.find('input[name="millis"]').val(""),j.$form.find('input[name="moveCount"]').val(""),j.$form.find('input[name="puzzlesSolvedCount"]').val(""),j.$form.find('input[name="puzzlesAttemptedCount"]').val(""),j.inputChanged();else if(a){var b="";jChester.solveTimeIsDNF(a)?b="DNF":jChester.solveTimeIsDNS(a)&&(b="DNS");var c;c=a.millis?jChester.solveTimeToStopwatchFormat(a,!0):b,j.$form.find('input[name="millis"]').val(c);var d;d=a.moveCount?a.moveCount:b,j.$form.find('input[name="moveCount"]').val(d),j.$form.find('input[name="puzzlesSolvedCount"]').val(a.puzzlesSolvedCount),j.$form.find('input[name="puzzlesAttemptedCount"]').val(a.puzzlesAttemptedCount),j.inputChanged()}};if("getSolveTime"===e)return j.solveTime;if("setSolveTime"===e){var l=arguments[1];return void k(l)}if("getValidationErrors"===e)return j.validationErrors;if(e)throw"Unrecognized method: "+e;return j.editableSolveTimeFields=i.editableSolveTimeFields,j.inputChanged(),k(i.solveTime),h},a.fn.jChester.defaults={solveTime:null,editableSolveTimeFields:{millis:!0}}}}("undefined"==typeof jQuery?null:jQuery);var MILLIS_PER_SECOND=1e3,MILLIS_PER_MINUTE=60*MILLIS_PER_SECOND,MILLIS_PER_HOUR=60*MILLIS_PER_MINUTE;jChester={stopwatchFormatToSolveTime:function(a,b){if(0===a.length)return null;if("DNF"===a.toUpperCase())return{puzzlesSolvedCount:0,puzzlesAttemptedCount:1};if("DNS"===a.toUpperCase())return{puzzlesSolvedCount:0,puzzlesAttemptedCount:0};if(b){if(!jChester._isInt(a))throw"Invalid move count.";var c=parseInt(a);if(c<=0)throw"Move count must be greater than zero.";return{moveCount:c}}var d=a.match(/^(?:(\d*):)??(?:(\d*):)?(\d+)?(?:[.,](\d*))?$/);if(!d)throw"Invalid stopwatch format.";var e=parseInt(d[1]||"0"),f=parseInt(d[2]||"0"),g=parseInt(d[3]||"0"),h=d[4]||"",i=parseInt(h||"0"),j=Math.pow(10,h.length-3),k=i?Math.round(i/j):0,l=e*MILLIS_PER_HOUR+f*MILLIS_PER_MINUTE+g*MILLIS_PER_SECOND+k;if(l<=0)throw"Time must be greater than zero.";var m=Math.min(3,h.length);return{millis:l,decimals:m}},solveTimeIsDNF:function(a){if("undefined"!=typeof a.puzzlesSolvedCount&&"undefined"!=typeof a.puzzlesAttemptedCount)if(1===a.puzzlesAttemptedCount){if(0===a.puzzlesSolvedCount)return!0}else if(a.puzzlesAttemptedCount>1){var b=a.puzzlesAttemptedCount-a.puzzlesSolvedCount,c=a.puzzlesSolvedCount-b;if(c<0||1===a.puzzlesSolvedCount)return!0}return!1},solveTimeIsDNS:function(a){return"undefined"!=typeof a.puzzlesAttemptedCount&&0===a.puzzlesAttemptedCount},solveTimeIsDN:function(a){return jChester.solveTimeIsDNF(a)||jChester.solveTimeIsDNS(a)},solveTimeToStopwatchFormat:function(a,b){function c(a,b,c){for(var d=a+"";d.length<c;)d=b+d;return d}if(!a)return"";if(!b){if(jChester.solveTimeIsDNF(a))return"DNF";if(jChester.solveTimeIsDNS(a))return"DNS"}if(a.moveCount)return a.moveCount.toFixed(a.decimals||0);var d=a.millis,e=Math.floor(d/MILLIS_PER_HOUR);d%=MILLIS_PER_HOUR;var f=Math.floor(d/MILLIS_PER_MINUTE);d%=MILLIS_PER_MINUTE;var g=Math.floor(d/MILLIS_PER_SECOND);d%=MILLIS_PER_SECOND;var h="";h.length>0?h+=":"+c(e,"0",2):e&&(h+=e),h.length>0?h+=":"+c(f,"0",2):f&&(h+=f),h+=h.length>0?":"+c(g,"0",2):g;var i=a.decimals;if(i>0){i=Math.min(3,i);var j=c(d,"0",3);h+=".";for(var k=0;k<i;k++)h+=j.charAt(k)}return h},_isInt:function(a){return 0!==a.length&&+a%1===0}};